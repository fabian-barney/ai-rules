# Security Reports Directory Structure

## Overview

This document explains the expected directory structure for storing security
assessment reports for each release.

## Directory Layout

The `security-reports/` directory should be created at the root of your project:

```text
project-root/
â”œâ”€â”€ security-reports/
â”‚   â”œâ”€â”€ v1.0.0/
â”‚   â”‚   â”œâ”€â”€ security-report.md
â”‚   â”‚   â”œâ”€â”€ dependency-check-report.html
â”‚   â”‚   â”œâ”€â”€ dependency-check-report.json
â”‚   â”‚   â””â”€â”€ cve-analysis.json
â”‚   â”œâ”€â”€ v1.0.1/
â”‚   â”‚   â”œâ”€â”€ security-report.md
â”‚   â”‚   â”œâ”€â”€ dependency-check-report.html
â”‚   â”‚   â”œâ”€â”€ dependency-check-report.json
â”‚   â”‚   â””â”€â”€ cve-analysis.json
â”‚   â”œâ”€â”€ v1.1.0/
â”‚   â”‚   â”œâ”€â”€ security-report.md
â”‚   â”‚   â”œâ”€â”€ dependency-check-report.html
â”‚   â”‚   â”œâ”€â”€ dependency-check-report.json
â”‚   â”‚   â””â”€â”€ cve-analysis.json
â”‚   â””â”€â”€ latest -> v1.1.0/
â”œâ”€â”€ src/
â”œâ”€â”€ docs/
â””â”€â”€ README.md
```

## File Descriptions

### security-report.md

The main security assessment report using the template from
[SECURITY_REPORT_TEMPLATE.md](SECURITY_REPORT_TEMPLATE.md).

**Contents:**
- Executive summary
- CVE summary (fixed, new, persistent)
- Detailed CVE analysis with contextual risk scores
- Comparison with previous release
- Recommendations and action items
- Accepted risks
- Dependency analysis
- Sign-off and approval

### dependency-check-report.html

HTML report generated by OWASP Dependency-Check or similar tools.

**Purpose:**
- Human-readable vulnerability report
- Detailed CVE information
- Dependency tree visualization
- Can be viewed in browser for review

### dependency-check-report.json

JSON report generated by dependency scanning tools.

**Purpose:**
- Machine-readable format
- Programmatic analysis
- Integration with other tools
- Historical tracking and trending

### cve-analysis.json

AI-generated contextual analysis of each CVE.

**Purpose:**
- Store AI-powered risk assessments
- Track contextual risk scores
- Document exploitability analysis
- Enable automated comparisons

**Example Structure:**

```json
{
  "version": "v1.0.1",
  "assessment_date": "2026-02-15T10:00:00Z",
  "total_dependencies": 150,
  "vulnerabilities": [
    {
      "cve_id": "CVE-2024-33333",
      "cvss_score": 7.5,
      "severity": "HIGH",
      "cwe": "CWE-22",
      "affected_component": "new-dependency@1.2.3",
      "published_date": "2024-12-15",
      "description": "Path traversal vulnerability...",
      "references": [
        "https://nvd.nist.gov/vuln/detail/CVE-2024-33333"
      ],
      "contextual_analysis": {
        "exploitability": "LOW",
        "impact": "MEDIUM",
        "exposure": "PROTECTED",
        "mitigation": "PARTIAL",
        "contextual_risk_score": 2.8,
        "analysis": "Vulnerable function is only used in admin-only endpoints...",
        "recommendation": "Monitor for patch, acceptable for current release"
      }
    }
  ],
  "comparison": {
    "previous_version": "v1.0.0",
    "fixed_cves": ["CVE-2024-11111", "CVE-2024-22222"],
    "new_cves": ["CVE-2024-33333"],
    "persistent_cves": ["CVE-2024-44444"]
  }
}
```

## Symbolic Link: latest

The `latest` symbolic link always points to the most recent release's security
report directory.

**Purpose:**
- Quick access to current security posture
- Simplified CI/CD integration
- Dashboard and monitoring tools can reference stable path

**Management:**

```bash
# Create or update the latest link
cd security-reports
rm -f latest
ln -s v1.1.0 latest

# Verify the link
ls -la latest
```

## Gitignore Considerations

**Recommended `.gitignore` entries:**

```gitignore
# Keep structure but optionally exclude large HTML reports
# security-reports/**/dependency-check-report.html

# Always commit these for audit trail:
# security-reports/**/security-report.md
# security-reports/**/cve-analysis.json

# Optionally exclude JSON if too large
# security-reports/**/dependency-check-report.json
```

**Recommendation:** Commit all security reports to git for:
- Complete audit trail
- Historical tracking
- Compliance requirements
- Release documentation

## Automation Example

Example script to create security report directory:

```bash
#!/bin/bash
# prepare-security-report.sh

VERSION=$1

if [ -z "$VERSION" ]; then
  echo "Usage: $0 vX.Y.Z"
  exit 1
fi

# Create directory
mkdir -p "security-reports/$VERSION"

echo "ðŸ“ Created security-reports/$VERSION/"

# Run OWASP Dependency-Check
echo "ðŸ” Running OWASP Dependency-Check..."
dependency-check \
  --project "MyProject" \
  --scan . \
  --format HTML \
  --format JSON \
  --out "security-reports/$VERSION/"

echo "âœ… Scan complete. Reports in security-reports/$VERSION/"

# Create symlink
cd security-reports
rm -f latest
ln -s "$VERSION" latest

echo "ðŸ”— Updated 'latest' symlink to $VERSION"
echo ""
echo "Next steps:"
echo "1. Review dependency-check-report.html"
echo "2. Generate cve-analysis.json using AI analysis"
echo "3. Complete security-report.md using the template"
```

## Integration with CI/CD

### GitHub Actions Example

```yaml
name: Security Assessment

on:
  push:
    tags:
      - 'v*'

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Extract version
        id: version
        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Create security report directory
        run: mkdir -p security-reports/${{ steps.version.outputs.VERSION }}

      - name: Run OWASP Dependency-Check
        uses: dependency-check/Dependency-Check_Action@main
        with:
          project: 'MyProject'
          path: '.'
          format: 'HTML,JSON'
          out: 'security-reports/${{ steps.version.outputs.VERSION }}'

      - name: Generate AI CVE Analysis
        run: |
          # Custom script to analyze CVEs with AI
          ./scripts/analyze-cves.sh \
            security-reports/${{ steps.version.outputs.VERSION }}/dependency-check-report.json \
            > security-reports/${{ steps.version.outputs.VERSION }}/cve-analysis.json

      - name: Commit security reports
        run: |
          git config user.name "Security Bot"
          git config user.email "security-bot@example.com"
          git add security-reports/${{ steps.version.outputs.VERSION }}
          git commit -m "chore: add security report for ${{ steps.version.outputs.VERSION }}"
          git push
```

## Historical Tracking

Security reports should be retained for:

**Compliance:** Audit trail for security assessments
**Trending:** Track security posture over time
**Comparison:** See how vulnerabilities are addressed
**Learning:** Understand past security decisions

### Metrics to Track Over Time

- Total CVE count per release
- Severity distribution trends
- Time to remediate vulnerabilities
- Accepted risk patterns
- Dependency update frequency
- CVSS score trends
- Contextual risk score trends

### Example Analysis Query

```bash
# Count CVEs by severity across all releases
find security-reports/*/cve-analysis.json -exec \
  jq -r '.vulnerabilities[] | .severity' {} \; | \
  sort | uniq -c

# Average contextual risk score over time
for dir in security-reports/v*/; do
  version=$(basename "$dir")
  avg=$(jq '.vulnerabilities | map(.contextual_analysis.contextual_risk_score) | add / length' \
    "$dir/cve-analysis.json")
  echo "$version: $avg"
done
```

## Best Practices

1. **Consistent Naming:** Always use `vX.Y.Z` format for directories
2. **Complete Reports:** Include all required files for each version
3. **Commit to VCS:** Keep security reports in version control
4. **Update Latest:** Always update the `latest` symlink
5. **Automation:** Automate report generation in CI/CD
6. **Review Process:** Require sign-off before release
7. **Retention Policy:** Define how long to keep old reports
8. **Access Control:** Limit access to security reports if sensitive

## Archive and Cleanup

For very old releases, consider:

### Option 1: Archive to separate repo

```bash
# Move old reports to archive repo
git subtree split --prefix=security-reports/v1.0.0 -b archive-v1.0.0
cd ../security-archive
git subtree add --prefix=v1.0.0 ../main-repo archive-v1.0.0
```

### Option 2: Keep all in main repo

For most projects, keeping all security reports in the main repository is
recommended for complete audit trail and easy access.

## Summary

The security reports directory structure provides:
- **Organized** storage of security assessments
- **Historical** tracking of vulnerabilities
- **Comparison** capability between releases
- **Automation** friendly structure
- **Audit trail** for compliance
- **Easy access** via latest symlink

Follow this structure consistently across all releases for maintainable and
comprehensive security documentation.
